{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ª±c ph·∫©m t∆∞∆°i s·ªëng</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">

    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">

    <link rel="stylesheet" href="{% static 'css/aos.css' %}">

    <link rel="stylesheet" href="{% static 'css/ionicons.min.css' %}">

    <link rel="stylesheet" href="{% static 'css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.timepicker.css' %}">


    <link rel="stylesheet" href="{% static 'css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="goto-here">
<!-- header -->
<header>
    <div class="py-1 bg-primary">
        <div class="container">
            <div class="row no-gutters d-flex align-items-start align-items-center px-md-0">
                <div class="col-lg-12 d-block">
                    <div class="row d-flex">
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <div class="icon mr-2 d-flex justify-content-center align-items-center"><span
                                    class="icon-phone2"></span></div>
                            <span class="text">+ 8492 1955 395</span>
                        </div>
                        <div class="col-md pr-4 d-flex topper align-items-center">
                            <div class="icon mr-2 d-flex justify-content-center align-items-center"><span
                                    class="icon-paper-plane"></span></div>
                            <span class="text">23130227@st.hcmuaf.edu.vn</span>
                        </div>
                        <div class="col-md-5 pr-4 d-flex topper align-items-center text-lg-right">
                            <span class="text">Giao h√†ng trong 3-5 ng√†y l√†m vi·ªác & Mi·ªÖn ph√≠ ƒë·ªïi tr·∫£</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="{% url 'index' %}">FreshFood</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
                    aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>

            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active"><a href="{% url 'index' %}" class="nav-link">Trang ch·ªß</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="dropdown04"
                           data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">Danh m·ª•c</a>
                        <div class="dropdown-menu" aria-labelledby="dropdown04">
                            <a class="dropdown-item" href="{% url 'shop_all_products' %}">T·∫•t c·∫£ s·∫£n ph·∫©m</a>
                            {% for c in categories %}
                                <a class="dropdown-item" href="{{ c.get_absolute_url }}">{{ c.name }}</a>
                            {% endfor %}
                        </div>
                    </li>
                    <li class="nav-item"><a href="{% url 'about' %}" class="nav-link">V·ªÅ ch√∫ng t√¥i</a></li>
                    <li class="nav-item"><a href="{% url 'blog' %}" class="nav-link">Tin t·ª©c</a></li>
                    <li class="nav-item"><a href="{% url 'contact' %}" class="nav-link">Li√™n h·ªá</a></li>
                    {% if user.is_authenticated and not user.is_staff and not user.is_superuser %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="dropdown04"
                               data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">{{ user.first_name }}</a>
                            <div class="dropdown-menu" aria-labelledby="dropdown04">
                                <a class="dropdown-item" href="{% url 'logout' %}">ƒêƒÉng xu·∫•t</a>
                            </div>
                        </li>
                    {% else %}
                        <li class="nav-item"><a href="{% url 'login' %}" class="nav-link">ƒêƒÉng nh·∫≠p</a></li>
                        <li class="nav-item"><a href="{% url 'register' %}" class="nav-link">ƒêƒÉng k√Ω</a></li>
                    {% endif %}
                    <li class="nav-item"><a href="{% url 'search_results' %}" class="nav-link"><span
                            class="icon-search"></span></a></li>
                    <li class="nav-item cta cta-colored">
                        <a href="{% url 'cart' %}" class="nav-link">
                            <span class="icon-shopping_cart"></span>
                            [{% if cart_count %}{{ cart_count }}{% else %}0{% endif %}]
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<!-- content -->
{% block content %} {% endblock content %}

<!-- footer -->
<footer class="ftco-footer ftco-section">
    <div class="container">
        <div class="row">
            <div class="mouse">
                <a href="#" class="mouse-icon">
                    <div class="mouse-wheel"><span class="ion-ios-arrow-up"></span></div>
                </a>
            </div>
        </div>
        <div class="row mb-5">
            <div class="col-md">
                <div class="ftco-footer-widget mb-4">
                    <h2 class="ftco-heading-2">FreshFood</h2>
                    <p>R·∫•t xa, ph√≠a sau nh·ªØng ng·ªçn n√∫i t·ª´ ng·ªØ, xa c√°c qu·ªëc gia Vokalia v√† Consonantia.</p>
                    <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
                        <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
                        <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
                        <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md">
                <div class="ftco-footer-widget mb-4 ml-md-5">
                    <h2 class="ftco-heading-2">Menu</h2>
                    <ul class="list-unstyled">
                        <li><a href="#" class="py-2 d-block">C·ª≠a h√†ng</a></li>
                        <li><a href="#" class="py-2 d-block">V·ªÅ ch√∫ng t√¥i</a></li>
                        <li><a href="#" class="py-2 d-block">Tin t·ª©c</a></li>
                        <li><a href="#" class="py-2 d-block">Li√™n h·ªá</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ftco-footer-widget mb-4">
                    <h2 class="ftco-heading-2">H·ªó tr·ª£</h2>
                    <div class="d-flex">
                        <ul class="list-unstyled mr-l-5 pr-l-3 mr-4">
                            <li><a href="#" class="py-2 d-block">Th√¥ng tin giao h√†ng</a></li>
                            <li><a href="#" class="py-2 d-block">ƒê·ªïi tr·∫£ &amp; ho√†n ti·ªÅn</a></li>
                            <li><a href="#" class="py-2 d-block">ƒêi·ªÅu kho·∫£n &amp; ƒëi·ªÅu ki·ªán</a></li>
                            <li><a href="#" class="py-2 d-block">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                        </ul>
                        <ul class="list-unstyled">
                            <li><a href="#" class="py-2 d-block">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
                            <li><a href="#" class="py-2 d-block">Li√™n h·ªá</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md">
                <div class="ftco-footer-widget mb-4">
                    <h2 class="ftco-heading-2">B·∫°n c√≥ c√¢u h·ªèi?</h2>
                    <div class="block-23 mb-3">
                        <ul>
                            <li><span class="icon icon-map-marker"></span><span class="text">203 ƒê∆∞·ªùng Gi·∫£, Qu·∫≠n N√∫i, Th√†nh ph·ªë H·ªì Ch√≠ Minh, Vi·ªát Nam</span>
                            </li>
                            <li><a href="#"><span class="icon icon-phone"></span><span
                                    class="text">+2 392 3929 210</span></a></li>
                            <li><a href="#"><span class="icon icon-envelope"></span><span class="text">info@yourdomain.com</span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center">

                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    B·∫£n quy·ªÅn &copy;<script>document.write(new Date().getFullYear());</script>
                    ƒê√£ ƒëƒÉng k√Ω b·∫£n quy·ªÅn | Giao di·ªán ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi <i class="icon-heart color-danger"
                                                                        aria-hidden="true"></i> b·ªüi <a
                            href="https://colorlib.com" target="_blank">Colorlib</a>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- loader -->
<div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px">
        <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
        <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00"/>
    </svg>
</div>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/jquery-migrate-3.0.1.min.js' %}"></script>
<script src="{% static 'js/popper.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
<script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'js/jquery.stellar.min.js' %}"></script>
<script src="{% static 'js/owl.carousel.min.js' %}"></script>
<script src="{% static 'js/jquery.magnific-popup.min.js' %}"></script>
<script src="{% static 'js/aos.js' %}"></script>
<script src="{% static 'js/jquery.animateNumber.min.js' %}"></script>
<script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'js/scrollax.min.js' %}"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="{% static 'js/google-map.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script>
    function disableSubmit(form) {
        const btn = form.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.innerText = 'ƒêang x·ª≠ l√Ω...';
    }
</script>
{% block scripts %} {% endblock scripts %}

<!-- N√∫t chat AI n·ªïi v√† h·ªôp tho·∫°i chat -->
<style>
    #ai-chat-btn {
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 9999;
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 56px;
        height: 56px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        font-size: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
    }

    #ai-chat-btn:hover {
        background: #0056b3;
    }

    #ai-chat-box {
        position: fixed;
        bottom: 100px;
        right: 32px;
        width: 350px;
        max-width: 90vw;
        height: 480px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        z-index: 10000;
        display: none;
        flex-direction: column;
        overflow: hidden;
    }

    #ai-chat-header {
        background: #007bff;
        color: #fff;
        padding: 12px 16px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #ai-chat-close {
        background: none;
        border: none;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
    }

    #ai-chat-messages {
        flex: 1;
        padding: 16px;
        overflow-y: auto;
        background: #f8f9fa;

        display: flex;
        flex-direction: column;
    }

    #ai-chat-input {
        display: flex;
        border-top: 1px solid #eee;
    }

    #ai-chat-input input {
        flex: 1;
        border: none;
        padding: 12px;
        font-size: 15px;
        outline: none;
    }

    #ai-chat-input button {
        background: #007bff;
        color: #fff;
        border: none;
        padding: 0 18px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 0 0 12px 0;
    }

    .ai-loading {
        display: inline-block;
        width: 14px;
        height: 14px;
        border: 2px solid #ccc;
        border-top: 2px solid #333;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-right: 6px;
        vertical-align: middle;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .user-msg {
        background: #007bff;
        color: #fff;
        padding: 6px 12px;
        border-radius: 16px;
        display: inline-block;
        margin: 8px 0;
        text-align: right;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
    }

    .ai-msg {
        background: #eee;
        color: #333;
        padding: 6px 12px;
        border-radius: 16px;
        display: inline-block;
        margin: 8px 0;
        text-align: left;
        font-style: normal;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
    }

    .ai-msg.loading {
        font-style: italic;
    }
</style>

<button id="ai-chat-btn" title="Chat v·ªõi AI">
    <span>üí¨</span>
</button>
<div id="ai-chat-box">
    <div id="ai-chat-header">
        Chat v·ªõi AI
        <button id="ai-chat-close" title="ƒê√≥ng">&times;</button>
    </div>
    <div id="ai-chat-messages">
        <div style="color: #888; text-align: center; margin-top: 40px;">Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</div>
    </div>
    <form id="ai-chat-input">
        {% csrf_token %}
        <label for="ai-chat-input-text" class="sr-only">Nh·∫≠p tin nh·∫Øn</label>
        <input id="ai-chat-input-text" type="text" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off"/>
        <button id="ai-chat-send-btn" type="submit">G·ª≠i</button>
    </form>
</div>
<script>
    const chatBtn = document.getElementById('ai-chat-btn');
    const chatBox = document.getElementById('ai-chat-box');
    const chatClose = document.getElementById('ai-chat-close');
    chatBtn.onclick = () => {
        chatBox.style.display = 'flex';
        chatBtn.style.display = 'none';
    };
    chatClose.onclick = () => {
        chatBox.style.display = 'none';
        chatBtn.style.display = 'flex';
    };

    document.getElementById('ai-chat-input').addEventListener('submit', function (e) {
        e.preventDefault();

        const input = document.getElementById('ai-chat-input-text');
        const sendBtn = document.getElementById('ai-chat-send-btn');
        const message = input.value.trim();

        if (!message) return;
        const messages = document.getElementById('ai-chat-messages');

        const userMsg = document.createElement('div');
        userMsg.className = 'user-msg';
        userMsg.textContent = message;

        messages.appendChild(userMsg);
        messages.scrollTop = messages.scrollHeight;

        input.value = '';
        input.disabled = true;
        sendBtn.disabled = true;

        const loadingMsg = document.createElement('div');
        loadingMsg.className = 'ai-msg loading';
        const spinner = document.createElement('span');
        spinner.className = 'ai-loading';
        loadingMsg.appendChild(spinner);
        const loadingText = document.createElement('span');
        loadingText.textContent = 'ƒêang tr·∫£ l·ªùi...';
        loadingMsg.appendChild(loadingText);

        messages.appendChild(loadingMsg);
        messages.scrollTop = messages.scrollHeight;


        fetch("{% url 'ai_chat' %}", {
            method: "POST",
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({message: message})
        }).then(response => response.json()).then(data => {
            messages.removeChild(loadingMsg);
            const aiMsg = document.createElement('div');
            aiMsg.className = 'ai-msg';
            aiMsg.textContent = data.reply;
            messages.appendChild(aiMsg);

            input.disabled = false;
            sendBtn.disabled = false;
            input.focus();
            messages.scrollTop = messages.scrollHeight;
        }).catch(() => {
            messages.removeChild(loadingMsg);
            input.disabled = false;
            sendBtn.disabled = false;
            input.focus();
            alert('Kh√¥ng g·ª≠i ƒë∆∞·ª£c tin nh·∫Øn, th·ª≠ l·∫°i!');
        });
    });
</script>
</body>
</html>
